<center><b><font size=12>Comprehensive Guide to Ultralytics YOLOv5</font></b></center>

# 1. è‡ªå®šä¹‰æ•°æ®é›†

## 1.1 ç¯å¢ƒå®‰è£…

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**æ³¨æ„**ï¼š
1. å®‰è£… `lxml`
2. Pillow ç‰ˆæœ¬è¦ä½äº 10.0.0ï¼Œè§£é‡Šé“¾æ¥: [module 'PIL.Image' has no attribute 'ANTIALIAS' é—®é¢˜å¤„ç†](https://baijiahao.baidu.com/s?id=1775432196700665405)

## 1.2 åˆ›å»ºæ•°æ®é›†

æˆ‘ä»¬è‡ªå·±ä¸‹è½½ PASCAL VOC ä¹Ÿè¡Œï¼ŒæŒ‰ç…§ PASCAL VOC è‡ªå»ºä¸€ä¸ªä¹Ÿè¡Œï¼Œå…·ä½“è¿‡ç¨‹è§ [PASCAL VOC 2012æ•°æ®é›†è®²è§£ä¸åˆ¶ä½œè‡ªå·±çš„æ•°æ®é›†](https://blog.csdn.net/weixin_44878336/article/details/124540069)ã€‚

> æ–‡ç« ä¸é•¿

## 1.3 PASCAL VOC æ•°æ®é›†ç»“æ„

PASCAL VOC æ•°æ®é›†ç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚

```txt
PASCAL VOC 2012 æ•°æ®é›†
|
â”œâ”€â”€ VOC2012
|   â”œâ”€â”€ JPEGImages    # åŒ…å«æ‰€æœ‰å›¾åƒæ–‡ä»¶
|   |   â”œâ”€â”€ 2007_000027.jpg
|   |   â”œâ”€â”€ 2007_000032.jpg
|   |   â”œâ”€â”€ ...
|   |
|   â”œâ”€â”€ Annotations    # åŒ…å«æ‰€æœ‰æ ‡æ³¨æ–‡ä»¶ï¼ˆXMLæ ¼å¼ï¼‰
|   |   â”œâ”€â”€ 2007_000027.xml
|   |   â”œâ”€â”€ 2007_000032.xml
|   |   â”œâ”€â”€ ...
|   |
|   â”œâ”€â”€ ImageSets
|   |   â”œâ”€â”€ Main
|   |   |   â”œâ”€â”€ train.txt  # è®­ç»ƒé›†çš„å›¾åƒæ–‡ä»¶åˆ—è¡¨
|   |   |   â”œâ”€â”€ val.txt    # éªŒè¯é›†çš„å›¾åƒæ–‡ä»¶åˆ—è¡¨
|   |   |   â”œâ”€â”€ test.txt   # æµ‹è¯•é›†çš„å›¾åƒæ–‡ä»¶åˆ—è¡¨
|   |
|   â”œâ”€â”€ SegmentationClass  # è¯­ä¹‰åˆ†å‰²çš„æ ‡æ³¨
|   |   â”œâ”€â”€ 2007_000032.png
|   |   â”œâ”€â”€ ...
|   |
|   â”œâ”€â”€ SegmentationObject  # ç‰©ä½“åˆ†å‰²çš„æ ‡æ³¨
|   |   â”œâ”€â”€ 2007_000032.png
|   |   â”œâ”€â”€ ...
|   |
|   â”œâ”€â”€ ...               # å…¶ä»–å¯èƒ½çš„å­æ–‡ä»¶å¤¹
|
â”œâ”€â”€ VOCdevkit
|   â”œâ”€â”€ VOCcode          # åŒ…å«ç”¨äºå¤„ç†æ•°æ®é›†çš„å·¥å…·ä»£ç 
|
â”œâ”€â”€ README
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ªæ–‡ä»¶å¤¹å°±å¯ä»¥äº†ã€‚

1. JPEGImages: å­˜æ”¾æ‰€æœ‰çš„å›¾ç‰‡
2. Annotations: å­˜æ”¾æ‰€æœ‰çš„æ ‡æ³¨ä¿¡æ¯

è¿™é‡Œæˆ‘ä»¬ä» PASCAL VOC ä¸­æå–å‡ºå‡ å¼ å›¾ç‰‡ï¼Œç»„æˆ VOC2012-Liteï¼š

<div align=center>
    <img src=./imgs_markdown/2023-10-18-17-19-28.png
    width=30%>
</div>

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒYOLOv5 çš„è¦æ±‚æ ‡æ³¨æ–‡ä»¶åç¼€ä¸º `.txt`ï¼Œä½† Annotations ä¸­çš„æ–‡ä»¶åç¼€æ˜¯ `.xml`ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œè½¬æ¢ã€‚

<details>
<summary>YOLO æ ‡æ³¨æ–‡ä»¶è¯´æ˜ </summary>

æ ‡æ³¨æ–‡ä»¶ä¸¾ä¾‹ï¼š

```txt
0 0.481719 0.634028 0.690625 0.713278
1 0.741094 0.524306 0.314750 0.933389
2 0.254162 0.247742 0.574520 0.687422
```

å…¶ä¸­ï¼Œæ¯è¡Œä»£è¡¨ä¸€ä¸ªç‰©ä½“çš„æ ‡æ³¨ï¼Œæ¯ä¸ªæ ‡æ³¨åŒ…æ‹¬äº”ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯ï¼š

1. `<class_id>`ï¼šç‰©ä½“çš„ç±»åˆ«æ ‡è¯†ç¬¦ã€‚åœ¨è¿™é‡Œï¼Œæœ‰ä¸‰ä¸ªä¸åŒçš„ç±»åˆ«ï¼Œåˆ†åˆ«ç”¨ 0ã€1 å’Œ 2 è¡¨ç¤ºã€‚
2. `<center_x>`ï¼šç‰©ä½“è¾¹ç•Œæ¡†çš„ä¸­å¿ƒç‚¹ x åæ ‡ï¼Œå½’ä¸€åŒ–åˆ°å›¾åƒå®½åº¦ã€‚è¿™äº›å€¼çš„èŒƒå›´åº”åœ¨ 0 åˆ° 1 ä¹‹é—´ã€‚
3. `<center_y>`ï¼šç‰©ä½“è¾¹ç•Œæ¡†çš„ä¸­å¿ƒç‚¹ y åæ ‡ï¼Œå½’ä¸€åŒ–åˆ°å›¾åƒé«˜åº¦ã€‚åŒæ ·ï¼Œè¿™äº›å€¼çš„èŒƒå›´åº”åœ¨ 0 åˆ° 1 ä¹‹é—´ã€‚
4. `<width>`ï¼šç‰©ä½“è¾¹ç•Œæ¡†çš„å®½åº¦ï¼Œå½’ä¸€åŒ–åˆ°å›¾åƒå®½åº¦ã€‚
5. `<height>`ï¼šç‰©ä½“è¾¹ç•Œæ¡†çš„é«˜åº¦ï¼Œå½’ä¸€åŒ–åˆ°å›¾åƒé«˜åº¦ã€‚

ä»¥ç¬¬ä¸€è¡Œä¸ºä¾‹ï¼š

- `<class_id>` æ˜¯ 0ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰©ä½“å±äºç±»åˆ« 0ã€‚
- `<center_x>` æ˜¯ 0.481719ï¼Œè¿™æ„å‘³ç€ç‰©ä½“è¾¹ç•Œæ¡†çš„ä¸­å¿ƒç‚¹ x åæ ‡ä½äºå›¾åƒå®½åº¦çš„ 48.17% å¤„ã€‚
- `<center_y>` æ˜¯ 0.634028ï¼Œä¸­å¿ƒç‚¹ y åæ ‡ä½äºå›¾åƒé«˜åº¦çš„ 63.40% å¤„ã€‚
- `<width>` æ˜¯ 0.690625ï¼Œè¾¹ç•Œæ¡†å®½åº¦å å›¾åƒå®½åº¦çš„ 69.06%ã€‚
- `<height>` æ˜¯ 0.713278ï¼Œè¾¹ç•Œæ¡†é«˜åº¦å å›¾åƒé«˜åº¦çš„ 71.33%ã€‚

</details>

## 1.4 YOLO æƒ³è¦çš„æ•°æ®é›†ç»“æ„

### 1.4.1 YOLOv3

ä¸€èˆ¬è€Œè¨€ï¼ŒYOLOv3 æƒ³è¦çš„æ•°æ®ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š

```txt
YOLOv3 æ•°æ®é›†
|
â”œâ”€â”€ images         # åŒ…å«æ‰€æœ‰å›¾åƒæ–‡ä»¶
|   â”œâ”€â”€ image1.jpg
|   â”œâ”€â”€ image2.jpg
|   â”œâ”€â”€ ...
|
â”œâ”€â”€ labels         # åŒ…å«æ‰€æœ‰æ ‡æ³¨æ–‡ä»¶ï¼ˆæ¯ä¸ªå›¾åƒå¯¹åº”ä¸€ä¸ªæ ‡æ³¨æ–‡ä»¶ï¼‰
|   â”œâ”€â”€ image1.txt
|   â”œâ”€â”€ image2.txt
|   â”œâ”€â”€ ...
|
â”œâ”€â”€ classes.names  # ç±»åˆ«æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰ç±»åˆ«çš„åç§°
|
â”œâ”€â”€ train.txt      # è®­ç»ƒé›†çš„å›¾åƒæ–‡ä»¶åˆ—è¡¨
â”œâ”€â”€ valid.txt      # éªŒè¯é›†çš„å›¾åƒæ–‡ä»¶åˆ—è¡¨
```

### 1.4.2 YOLOv5

ä¸ YOLOv3 ä¸åŒï¼ŒYOLOv5 æ‰€éœ€è¦çš„æ•°æ®é›†ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š

```txt
|-- test
|   |-- images
|   |   |-- 000000000036.jpg
|   |   `-- 000000000042.jpg
|   `-- labels
|       |-- 000000000036.txt
|       `-- 000000000042.txt
|-- train
|   |-- images
|   |   |-- 000000000009.jpg
|   |   `-- 000000000025.jpg
|   `-- labels
|       |-- 000000000009.txt
|       `-- 000000000025.txt
`-- val
    |-- images
    |   |-- 000000000030.jpg
    |   `-- 000000000034.jpg
    `-- labels
        |-- 000000000030.txt
        `-- 000000000034.txt
```

æ ¹æ® `.yaml` é…ç½®æ–‡ä»¶å˜åŠ¨è€Œå˜åŠ¨çš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ `coco128.yaml` ä¸ºä¾‹:

```yaml
# YOLOv5 ğŸš€ by Ultralytics, AGPL-3.0 license
# COCO128 dataset https://www.kaggle.com/ultralytics/coco128 (first 128 images from COCO train2017) by Ultralytics
# Example usage: python train.py --data coco128.yaml
# parent
# â”œâ”€â”€ yolov5
# â””â”€â”€ datasets
#     â””â”€â”€ coco128  â† downloads here (7 MB)


# Train/val/test sets as 1) dir: path/to/imgs, 2) file: path/to/imgs.txt, or 3) list: [path/to/imgs1, path/to/imgs2, ..]
path: ../datasets/coco128  # dataset root dir
train: images/train2017  # train images (relative to 'path') 128 images
val: images/train2017  # val images (relative to 'path') 128 images
test:  # test images (optional)

# Classes
names:
  0: person
  1: bicycle
  2: car
  3: motorcycle
  4: airplane
  5: bus
  6: train
  7: truck
  8: boat
  9: traffic light
  10: fire hydrant
  ...


# Download script/URL (optional)
download: https://ultralytics.com/assets/coco128.zip
```

coco128 çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š

```
.
|-- LICENSE
|-- README.txt
|-- images
|   `-- train2017
|       |-- 000000000009.jpg
|       |-- 000000000025.jpg
|       |-- 000000000030.jpg
|       |-- 000000000034.jpg
|       |-- 000000000036.jpg
|       |-- 000000000042.jpg
        ...
`-- labels
    `-- train2017
        |-- 000000000009.txt
        |-- 000000000025.txt
        |-- 000000000030.txt
        |-- 000000000034.txt
        |-- 000000000036.txt
        |-- 000000000042.txt
        ...
```














## 2.3 é€‰æ‹©æ¨¡å‹

é€‰æ‹©ä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹æ¥å¼€å§‹è®­ç»ƒã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹© YOLOv5sï¼Œè¿™æ˜¯ç¬¬äºŒå°å’Œé€Ÿåº¦æœ€å¿«çš„å¯ç”¨æ¨¡å‹ã€‚

<div align=center>
    <img src=https://github.com/ultralytics/yolov5/releases/download/v1.0/model_comparison.png
    width=100%>
</div>

## 2.4 è®­ç»ƒ

é€šè¿‡æŒ‡å®šæ•°æ®é›†ã€æ‰¹æ¬¡å¤§å°ã€å›¾åƒå¤§å°ä»¥åŠé¢„è®­ç»ƒæƒé‡ `--weights yolov5s.pt`ï¼ˆæ¨èï¼‰æˆ–éšæœºåˆå§‹åŒ–æƒé‡ `--weights` '' `--cfg yolov5s.yaml`ï¼ˆä¸æ¨èï¼‰ï¼Œæ¥åœ¨ COCO128 æ•°æ®é›†ä¸Šè®­ç»ƒ YOLOv5s æ¨¡å‹ã€‚é¢„è®­ç»ƒæƒé‡å°†ä¼šè‡ªåŠ¨ä»æœ€æ–°çš„ YOLOv5 å‘å¸ƒä¸­ä¸‹è½½ã€‚

```bash
python train.py --img 640 --epochs 3 --data coco128.yaml --weights yolov5s.pt
```

> ä¸ºäº†åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼Œå¯ä»¥æ·»åŠ  `--cache ram` æˆ– `--cache disk` é€‰é¡¹ï¼ˆéœ€è¦å¤§é‡çš„å†…å­˜/ç£ç›˜èµ„æºï¼‰
> å§‹ç»ˆä»æœ¬åœ°æ•°æ®é›†è¿›è¡Œè®­ç»ƒã€‚æŒ‚è½½æˆ–ç½‘ç»œé©±åŠ¨å™¨ï¼Œå¦‚ Google Driveï¼Œä¼šå¯¼è‡´è®­ç»ƒé€Ÿåº¦éå¸¸æ…¢ã€‚

æ‰€æœ‰è®­ç»ƒç»“æœéƒ½ä¼šä¿å­˜åœ¨ `runs/train/` ç›®å½•ä¸‹ï¼Œæ¯æ¬¡è®­ç»ƒéƒ½ä¼šåˆ›å»ºä¸€ä¸ªé€’å¢çš„è¿è¡Œç›®å½•ï¼Œä¾‹å¦‚ `runs/train/exp2`ã€`runs/train/exp3` ç­‰ç­‰ã€‚

## 2.5 å¯è§†åŒ–

è®­ç»ƒç»“æœä¼šè‡ªåŠ¨è®°å½•åœ¨ Tensorboard å’Œ CSV æ—¥å¿—è®°å½•å™¨ä¸­ï¼Œä¿å­˜åœ¨ `runs/train` ç›®å½•ä¸‹ï¼Œæ¯æ¬¡æ–°çš„è®­ç»ƒéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®éªŒç›®å½•ï¼Œä¾‹å¦‚ `runs/train/exp2`ã€`runs/train/exp3` ç­‰ã€‚

è¯¥ç›®å½•åŒ…å«äº†è®­ç»ƒå’ŒéªŒè¯çš„ç»Ÿè®¡æ•°æ®ã€é©¬èµ›å…‹å›¾åƒã€æ ‡ç­¾ã€é¢„æµ‹ç»“æœã€ä»¥åŠç»è¿‡å¢å¼ºçš„é©¬èµ›å…‹å›¾åƒï¼Œè¿˜åŒ…æ‹¬ Precision-Recallï¼ˆPRï¼‰æ›²çº¿å’Œæ··æ·†çŸ©é˜µç­‰åº¦é‡å’Œå›¾è¡¨ã€‚

<div align=center>
    <img src=./imgs_markdown/2023-10-18-14-01-15.png
    width=100%>
</div>

ç»“æœæ–‡ä»¶ `results.csv` åœ¨æ¯ä¸ª Epoch åæ›´æ–°ï¼Œç„¶ååœ¨è®­ç»ƒå®Œæˆåç»˜åˆ¶ä¸º `results.png`ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç»˜åˆ¶ä»»ä½• `results.csv` æ–‡ä»¶ï¼š

```python
from utils.plots import plot_results

plot_results('path/to/results.csv')  # plot 'results.csv' as 'results.png'
```

<div align=center>
    <img src=./imgs_markdown/2023-10-18-14-02-01.png
    width=100%>
</div>


















# çŸ¥è¯†æ¥æº

1. [Ultralytics YOLOv5 Docs](https://docs.ultralytics.com/yolov5/tutorials)