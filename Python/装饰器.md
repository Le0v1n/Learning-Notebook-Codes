# 1. è£…é¥°å™¨çš„åŸºæœ¬æ¦‚å¿µ

Pythonçš„è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ä¸ä¿®æ”¹åŸå§‹å‡½æ•°ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¢åŠ æˆ–ä¿®æ”¹å‡½æ•°çš„è¡Œä¸ºã€‚è£…é¥°å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚è¿™ä¸ªæ–°çš„å‡½æ•°é€šå¸¸ä¼šåŒ…å«ä¸€äº›é¢å¤–çš„é€»è¾‘ï¼Œç„¶åè°ƒç”¨åŸå§‹å‡½æ•°ã€‚

- **å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘**ï¼šåœ¨Pythonä¸­ï¼Œå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œè¿™æ„å‘³ç€å‡½æ•°å¯ä»¥åƒå…¶ä»–å¯¹è±¡ä¸€æ ·è¢«ä¼ é€’å’Œè¿”å›ã€‚è¿™ä½¿å¾—è£…é¥°å™¨çš„å®ç°æˆä¸ºå¯èƒ½ã€‚
- **é«˜é˜¶å‡½æ•°**ï¼šè£…é¥°å™¨æœ¬èº«æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå› ä¸ºå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚

# 2. è£…é¥°å™¨çš„åŸºæœ¬ç»“æ„

ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨é€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1. **è£…é¥°å™¨å‡½æ•°**ï¼šè¿™æ˜¯æœ€å¤–å±‚çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚
2. **åŒ…è£…å‡½æ•°**ï¼šè¿™æ˜¯è£…é¥°å™¨å†…éƒ¨å®šä¹‰çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒåŒ…è£…äº†åŸå§‹å‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶å¯ä»¥æ·»åŠ ä¸€äº›é¢å¤–çš„é€»è¾‘ã€‚
3. **è¿”å›åŒ…è£…å‡½æ•°**ï¼šè£…é¥°å™¨è¿”å›åŒ…è£…å‡½æ•°ï¼Œä»¥ä¾¿åœ¨è°ƒç”¨æ—¶æ‰§è¡ŒåŒ…è£…å‡½æ•°çš„é€»è¾‘ã€‚

# 3. è£…é¥°å™¨çš„åº”ç”¨åœºæ™¯

- **æ—¥å¿—è®°å½•**ï¼šåœ¨å‡½æ•°æ‰§è¡Œå‰åè®°å½•æ—¥å¿—ä¿¡æ¯ã€‚
- **æ€§èƒ½ç›‘æ§**ï¼šè®°å½•å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œç”¨äºæ€§èƒ½åˆ†æï¼ˆprofileï¼‰ã€‚
- **æƒé™æ£€æŸ¥**ï¼šåœ¨å‡½æ•°æ‰§è¡Œå‰æ£€æŸ¥ç”¨æˆ·æƒé™ã€‚
- **ç¼“å­˜ç»“æœ**ï¼šç¼“å­˜å‡½æ•°çš„è¿”å›ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—ã€‚
- **äº‹åŠ¡ç®¡ç†**ï¼šåœ¨æ•°æ®åº“æ“ä½œå‰åè¿›è¡Œäº‹åŠ¡ç®¡ç†ã€‚

# 4. è£…é¥°å™¨çš„é«˜çº§ç”¨æ³•

- **å¸¦å‚æ•°çš„è£…é¥°å™¨**ï¼šå¯ä»¥å®šä¹‰ä¸€ä¸ªè£…é¥°å™¨å·¥å‚å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—å‚æ•°å¹¶è¿”å›ä¸€ä¸ªè£…é¥°å™¨ã€‚
- **ç±»è£…é¥°å™¨**ï¼šå¯ä»¥ä½¿ç”¨ç±»æ¥å®ç°è£…é¥°å™¨ï¼Œç±»çš„å®ä¾‹æ–¹æ³•å¯ä»¥ä½œä¸ºåŒ…è£…å‡½æ•°ã€‚
- **å¤šå±‚è£…é¥°å™¨**ï¼šå¯ä»¥å°†å¤šä¸ªè£…é¥°å™¨åº”ç”¨äºåŒä¸€ä¸ªå‡½æ•°ï¼Œä»¥ç»„åˆä¸åŒçš„åŠŸèƒ½ã€‚

è£…é¥°å™¨æ˜¯Pythonä¸­ä¸€ç§éå¸¸çµæ´»å’Œå¼ºå¤§çš„å·¥å…·ï¼Œå®ƒä½¿å¾—ä»£ç çš„å¤ç”¨å’Œæ‰©å±•å˜å¾—æ›´åŠ æ–¹ä¾¿å’Œä¼˜é›…ã€‚

# 5 å‡½æ•°ç¤ºä¾‹

## 5.1 æœ€ç®€å•çš„è£…é¥°å™¨

```python
import time


def timing_decorator(func):
    def wrapper(*args, **kwargs):
        t1 = time.time()
        results = func(*args, **kwargs)
        t2 = time.time()

        print(f"å‡½æ•°åç§°: {func.__name__} è€—æ—¶: {t2 - t1:.2f}s")
        return results
    
    # æ‰‹åŠ¨è®¾ç½®meta info
    wrapper.__name__ == func.__name__
    wrapper.__doc__ == func.__doc__

    return wrapper

@timing_decorator
def exp_func(n):
    sum = 0
    for i in range(n + 1):
        time.sleep(1)
        sum += i
    return sum


if __name__ == "__main__":
    print(f"{exp_func(2) = }")
```

```
å‡½æ•°åç§°: exp_func è€—æ—¶: 3.00s
exp_func(2) = 3
```

## 5.2 ä½¿ç”¨from functools import wrapsçš„è£…é¥°å™¨

`from functools import wraps`çš„`wraps` å‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯å¸®åŠ©è£…é¥°å™¨ä¿ç•™è¢«è£…é¥°å‡½æ•°çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚å‡½æ•°åã€æ–‡æ¡£å­—ç¬¦ä¸²ç­‰ã€‚è¿™åœ¨ä½¿ç”¨è£…é¥°å™¨æ—¶éå¸¸é‡è¦ï¼Œå› ä¸ºè£…é¥°å™¨é€šå¸¸ä¼šç”¨ä¸€ä¸ªåŒ…è£…å‡½æ•°æ¥æ›¿ä»£åŸå§‹å‡½æ•°ï¼Œå¦‚æœä¸ä½¿ç”¨ `wraps`ï¼ŒåŸå§‹å‡½æ•°çš„å…ƒæ•°æ®å¯èƒ½ä¼šä¸¢å¤±ã€‚`wraps`è£…é¥°å™¨çš„ä¸»è¦ä½œç”¨ä¸ºï¼š

- **ä¿ç•™å‡½æ•°å**ï¼š`wraps` ä¼šå°†è¢«è£…é¥°å‡½æ•°çš„ `__name__` å±æ€§å¤åˆ¶åˆ°åŒ…è£…å‡½æ•°ä¸Šï¼Œè¿™æ ·åŒ…è£…å‡½æ•°çš„åç§°å°±ä¼šä¸åŸå§‹å‡½æ•°ç›¸åŒã€‚
- **ä¿ç•™æ–‡æ¡£å­—ç¬¦ä¸²**ï¼š`wraps` ä¼šå°†è¢«è£…é¥°å‡½æ•°çš„ `__doc__` å±æ€§å¤åˆ¶åˆ°åŒ…è£…å‡½æ•°ä¸Šï¼Œè¿™æ ·åŒ…è£…å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²å°±ä¼šä¸åŸå§‹å‡½æ•°ç›¸åŒã€‚
- **ä¿ç•™å…¶ä»–å±æ€§**ï¼š`wraps` è¿˜å¯ä»¥ä¿ç•™å…¶ä»–ä¸€äº›å‡½æ•°å±æ€§ï¼Œä¾‹å¦‚ `__module__` å’Œ `__annotations__`ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä¸ä½¿ç”¨å’Œä½¿ç”¨ `wraps` çš„å¯¹æ¯”ç¤ºä¾‹ï¼š

```python
import time
from functools import wraps

def timing_decorator(func):
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        print(f"Function {func.__name__} took {end_time - start_time:.4f} seconds to run.")
        return result
    return wrapper

def timing_decorator_with_wraps(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        print(f"Function {func.__name__} took {end_time - start_time:.4f} seconds to run.")
        return result
    return wrapper

@timing_decorator
def example_function(n):
    """Function to demonstrate the decorator."""
    sum = 0
    for i in range(n):
        sum += i
    return sum

@timing_decorator_with_wraps
def example_function_with_wraps(n):
    """Function to demonstrate the decorator with wraps."""
    sum = 0
    for i in range(n):
        sum = sum + i
    return sum

print("Without wraps:")
print(f"\t{example_function.__name__ = }")  # è¾“å‡º: wrapper
print(f"\t{example_function.__doc__ = }")   # è¾“å‡º: None

print("\nWith wraps:")
print(f"\t{example_function_with_wraps.__name__ = }")  # è¾“å‡º: example_function_with_wraps
print(f"\t{example_function_with_wraps.__doc__ = }")   # è¾“å‡º: Function to demonstrate the decorator with wraps.
```

```
Without wraps:
        example_function.__name__ = 'wrapper'
        example_function.__doc__ = None

With wraps:
        example_function_with_wraps.__name__ = 'example_function_with_wraps'
        example_function_with_wraps.__doc__ = 'Function to demonstrate the decorator with wraps.'
```

é€šè¿‡ä½¿ç”¨ `wraps`ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¡®ä¿è£…é¥°å™¨ä¸ä¼šç ´ååŸå§‹å‡½æ•°çš„å…ƒæ•°æ®ï¼Œä»è€Œä½¿ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç»´æŠ¤ã€‚

## 5.3 å¯ä»¥ä½¿ç”¨()è°ƒç”¨çš„è£…é¥°å™¨

ä¸€ä¸ªå¯ä»¥è¢« `()` è°ƒç”¨çš„è£…é¥°å™¨ï¼Œé€šå¸¸æ˜¯æŒ‡åˆ›å»ºä¸€ä¸ªè£…é¥°å™¨å·¥å‚å‡½æ•°ã€‚è¿™ä¸ªå·¥å‚å‡½æ•°å¯ä»¥æ¥å—ä¸€äº›å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªçœŸæ­£çš„è£…é¥°å™¨å‡½æ•°ã€‚è¿™ç§æ–¹å¼å…è®¸æˆ‘ä»¬åœ¨ä½¿ç”¨è£…é¥°å™¨æ—¶ä¼ é€’å‚æ•°ï¼Œä»è€Œå¢åŠ è£…é¥°å™¨çš„çµæ´»æ€§ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªå¯ä»¥æ¥å—å‚æ•°çš„è£…é¥°å™¨å·¥å‚å‡½æ•°ï¼š

```python
from functools import wraps


def repeat(times: int = 3):
    """
    è£…é¥°å™¨å·¥å‚å‡½æ•°ï¼Œå¯ä»¥è®©è¢«è£…é¥°å‡½æ•°é‡å¤è°ƒç”¨timesæ¬¡ã€‚

    Args:
        times (int, optional): å‡½æ•°éœ€è¦è¢«é‡å¤è°ƒç”¨çš„æ¬¡æ•°. Defaults to 3.
    """
    try:
        times: int = int(times)
    except Exception as e:
        raise e
    
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            results: list = []
            for _ in range(times):
                results.append(func(*args, **kwargs))
            return results
        return wrapper
    return decorator


@repeat(2)
def say_hello(name: str = 'Le0v1n') -> None:
    s = f"ğŸ˜Š Hello, {name}!"
    print(s)
    return s


if __name__ == '__main__':
    result = say_hello()
    print(f"{result = }")
```

```
ğŸ˜Š Hello, Le0v1n!
ğŸ˜Š Hello, Le0v1n!
result = ['ğŸ˜Š Hello, Le0v1n!', 'ğŸ˜Š Hello, Le0v1n!']
```

## 5.4 å¯ä»¥ç”¨äºä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„è£…é¥°å™¨

è¦ä½¿ç”¨ `contextlib` æ¨¡å—çš„ `contextmanager` è£…é¥°å™¨å°†ä¸€ä¸ªå‡½æ•°è½¬æ¢ä¸ºä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œå¹¶åœ¨è¯¥å‡½æ•°ä¸­ä½¿ç”¨ `yield` è¯­å¥ã€‚`yield` è¯­å¥ä¹‹å‰çš„ä»£ç ä¼šåœ¨è¿›å…¥ä¸Šä¸‹æ–‡æ—¶æ‰§è¡Œï¼ˆç›¸å½“äº `__enter__` æ–¹æ³•ï¼‰ï¼Œè€Œ `yield` è¯­å¥ä¹‹åçš„ä»£ç ä¼šåœ¨é€€å‡ºä¸Šä¸‹æ–‡æ—¶æ‰§è¡Œï¼ˆç›¸å½“äº `__exit__` æ–¹æ³•ï¼‰.

ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ `contextmanager` è£…é¥°å™¨å°†ä¸€ä¸ªå‡½æ•°è½¬æ¢ä¸ºä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼š

```python
from contextlib import contextmanager

@contextmanager
def managed_resource(resource_name):
    print(f"[ä¸Šä¸‹æ–‡ç®¡ç†å™¨] [è¿›å…¥] {resource_name}")

    # è¿™é‡Œå¯ä»¥æ·»åŠ è·å–èµ„æºçš„ä»£ç 
    resource = f"{resource_name}_temp"

    try:
        yield resource
    finally:
        print(f"[ä¸Šä¸‹æ–‡ç®¡ç†å™¨] [é€€å‡º] {resource_name}")
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ é‡Šæ”¾èµ„æºçš„ä»£ç 
        del resource


if __name__ == '__main__':
    # ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
    with managed_resource("example_resource") as resource:
        print(f"[è¢«ç®¡ç†çš„ä»£ç å—] ä½¿ç”¨èµ„æº: {resource}")
```

```
[ä¸Šä¸‹æ–‡ç®¡ç†å™¨] [è¿›å…¥] example_resource
[è¢«ç®¡ç†çš„ä»£ç å—] ä½¿ç”¨èµ„æº: example_resource_temp
[ä¸Šä¸‹æ–‡ç®¡ç†å™¨] [é€€å‡º] example_resource
```

**è§£é‡Š**ï¼š
- **`@contextmanager` è£…é¥°å™¨**ï¼šå°† `managed_resource` å‡½æ•°è½¬æ¢ä¸ºä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `with` è¯­å¥æ¥ç®¡ç†èµ„æºçš„è·å–å’Œé‡Šæ”¾ã€‚
- **ç”Ÿæˆå™¨å‡½æ•°**ï¼š
  - `managed_resource` æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œå®ƒåœ¨ `yield` è¯­å¥ä¹‹å‰æ‰§è¡Œè·å–èµ„æºçš„ä»£ç ï¼Œåœ¨ `yield` è¯­å¥ä¹‹åæ‰§è¡Œé‡Šæ”¾èµ„æºçš„ä»£ç ã€‚
- **`yield` è¯­å¥**ï¼š
  - `yield` è¯­å¥ç”¨äºæš‚åœå‡½æ•°çš„æ‰§è¡Œï¼Œå¹¶å°† `resource` è¿”å›ç»™ `with` è¯­å¥å—ä¸­çš„å˜é‡ï¼ˆå¦‚æœæœ‰ `as` å­å¥çš„è¯ï¼‰ã€‚
  - åœ¨ `with` è¯­å¥å—æ‰§è¡Œå®Œæ¯•åï¼Œå‡½æ•°ä¼šä» `yield` è¯­å¥å¤„ç»§ç»­æ‰§è¡Œï¼Œæ‰§è¡Œé‡Šæ”¾èµ„æºçš„ä»£ç ã€‚
- **å¼‚å¸¸å¤„ç†**ï¼šä½¿ç”¨ `try`-`finally` ç»“æ„å¯ä»¥ç¡®ä¿å³ä½¿åœ¨ `with` è¯­å¥å—ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œèµ„æºä¹Ÿèƒ½è¢«æ­£ç¡®é‡Šæ”¾ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- **èµ„æºç®¡ç†**ï¼šé€‚ç”¨äºéœ€è¦ç®¡ç†èµ„æºè·å–å’Œé‡Šæ”¾çš„åœºæ™¯ï¼Œå¦‚æ–‡ä»¶æ“ä½œã€æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥ç­‰ã€‚
- **ä»£ç å—æ‰§è¡Œå‰åé€»è¾‘**ï¼šé€‚ç”¨äºéœ€è¦åœ¨ä»£ç å—æ‰§è¡Œå‰åæ‰§è¡Œä¸€äº›ç‰¹å®šé€»è¾‘çš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ç­‰ã€‚

é€šè¿‡ä½¿ç”¨ `contextmanager` è£…é¥°å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†å‡½æ•°è½¬æ¢ä¸ºä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè€Œä¸éœ€è¦å®šä¹‰ä¸€ä¸ªå®Œæ•´çš„ç±»æ¥å®ç° `__enter__` å’Œ `__exit__` æ–¹æ³•.è¿™ç§æ–¹å¼ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´å’Œçµæ´»ã€‚

# 6. ç±»classç¤ºä¾‹

## 6.1 @classmethod

åœ¨Pythonä¸­ï¼Œ`@classmethod` æ˜¯ä¸€ä¸ªå†…ç½®çš„è£…é¥°å™¨ï¼Œç”¨äºå°†ä¸€ä¸ªæ–¹æ³•å®šä¹‰ä¸ºç±»æ–¹æ³•ã€‚ç±»æ–¹æ³•ä¸æ™®é€šå®ä¾‹æ–¹æ³•çš„ä¸»è¦åŒºåˆ«åœ¨äº<font color='red'><b>å®ƒä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯ç±»çš„å®ä¾‹</b></font>ï¼ˆå³ `self`ï¼‰ã€‚


```python
class ExampleClass:
    # å®šä¹‰ä¸€äº›ç±»å±æ€§
    attribute_1 = 'abc'
    attribute_2 = 123

    # å®šä¹‰ä¸€äº›æ™®é€šå®ä¾‹æ–¹æ³•
    def normal_instance_method_1(self, param1, param2):
        print(f"Instance method 1 called with {param1} and {param2}")

    def normal_instance_method_2(self, param1, param2):
        print(f"Instance method 2 called with {param1} and {param2}")

    # å®šä¹‰ç±»æ–¹æ³•
    @classmethod
    def class_method(cls):
        p1 = cls.attribute_1
        p2 = cls.attribute_2
        
        # ğŸš¨æ³¨æ„ï¼šè¿™é‡Œä¸èƒ½ç›´æ¥è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼Œå› ä¸ºå®ä¾‹æ–¹æ³•éœ€è¦å®ä¾‹å¯¹è±¡
        # æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å®ä¾‹æ–¹æ³•
        instance = cls()  # åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡
        return instance.normal_instance_method_1(
            param1=p1, 
            param2=p2
        )
```

ä½¿ç”¨ `@classmethod` è£…é¥°å™¨çš„ä¸»è¦ä½œç”¨åŒ…æ‹¬ï¼š

### 6.1.1 è®¿é—®ç±»å±æ€§å’Œç±»æ–¹æ³•

ç±»æ–¹æ³•å¯ä»¥è®¿é—®ç±»å±æ€§å’Œç±»æ–¹æ³•ï¼Œè€Œä¸éœ€è¦åˆ›å»ºç±»çš„å®ä¾‹ã€‚è¿™å¯¹äºé‚£äº›éœ€è¦æ“ä½œç±»çº§åˆ«çš„æ•°æ®æˆ–è¡Œä¸ºçš„æ–¹æ³•éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š

```python
class MyClass:
    class_attribute = "Hello"

    @classmethod
    def print_class_attribute(cls):
        print(cls.class_attribute)

MyClass.print_class_attribute()  # è¾“å‡º: Hello
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`print_class_attribute` æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨ï¼Œè€Œä¸éœ€è¦åˆ›å»ºç±»çš„å®ä¾‹ã€‚

### 6.1.2 ä½œä¸ºæ„é€ å‡½æ•°çš„æ›¿ä»£

ç±»æ–¹æ³•å¸¸ç”¨äºå®šä¹‰æ›¿ä»£æ„é€ å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»æ–¹æ³•æ¥åˆ›å»ºç±»çš„å®ä¾‹ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒçš„å‚æ•°æˆ–æ¡ä»¶æ¥åˆ›å»ºå®ä¾‹æ—¶ã€‚ä¾‹å¦‚ï¼š

```python
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age

    @classmethod
    def from_birth_year(cls, name, birth_year):
        age = 2025 - birth_year

        # è¿™é‡Œçš„cls()åˆ™æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å®ä¾‹
        return cls(name, age)

person = Person.from_birth_year("Le0v1n", 1996)
print(person.age)  # è¾“å‡º: 25
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`from_birth_year` æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼Œå®ƒæ ¹æ®å‡ºç”Ÿå¹´ä»½è®¡ç®—å¹´é¾„ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª `Person` å®ä¾‹ã€‚

### 6.1.3 å®ç°å¤šæ€

åœ¨ç»§æ‰¿ä½“ç³»ä¸­ï¼Œç±»æ–¹æ³•å¯ä»¥è¢«å­ç±»è¦†ç›–ï¼Œä»è€Œå®ç°å¤šæ€ã€‚è¿™æ„å‘³ç€å­ç±»å¯ä»¥æä¾›è‡ªå·±çš„ç±»æ–¹æ³•å®ç°ï¼Œè€Œçˆ¶ç±»çš„è°ƒç”¨è€…å¯ä»¥è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œè€Œä¸éœ€è¦çŸ¥é“å…·ä½“çš„å­ç±»ç±»å‹ã€‚ä¾‹å¦‚ï¼š

```python
class Animal:
    @classmethod
    def make_sound(cls):
        print("Some sound")

class Dog(Animal):
    @classmethod
    def make_sound(cls):
        print("Bark")

Animal.make_sound()  # è¾“å‡º: Some sound
Dog.make_sound()     # è¾“å‡º: Bark
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`Dog` ç±»è¦†ç›–äº† `Animal` ç±»çš„ `make_sound` ç±»æ–¹æ³•ï¼Œå®ç°äº†å¤šæ€ã€‚

---

ä½¿ç”¨ `@classmethod` è£…é¥°å™¨çš„ä¸»è¦å¥½å¤„æ˜¯èƒ½å¤Ÿä»¥ç±»ä¸ºå•ä½è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯ä¾èµ–äºå®ä¾‹ã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å¤„ç†ç±»çº§åˆ«çš„æ•°æ®æˆ–è¡Œä¸ºæ—¶ã€‚

## 6.2 @staticmethod

åœ¨Pythonä¸­ï¼Œ`@staticmethod` æ˜¯ä¸€ä¸ªå†…ç½®çš„è£…é¥°å™¨ï¼Œç”¨äºå°†ä¸€ä¸ªæ–¹æ³•å®šä¹‰ä¸ºé™æ€æ–¹æ³•ã€‚**é™æ€æ–¹æ³•ä¸ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬ä¸æ¥å— `self` æˆ– `cls` ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°**ã€‚ä½¿ç”¨ `@staticmethod` è£…é¥°å™¨çš„ä¸»è¦ä½œç”¨åŒ…æ‹¬ï¼š

1. **ä¸ä¾èµ–äºç±»æˆ–å®ä¾‹çŠ¶æ€**ï¼šé™æ€æ–¹æ³•ä¸ä¾èµ–äºç±»æˆ–å®ä¾‹çš„ä»»ä½•çŠ¶æ€ï¼ˆå±æ€§ï¼‰ã€‚å®ƒä»¬é€šå¸¸ç”¨äºå®ç°ä¸ç±»ç›¸å…³çš„åŠŸèƒ½ï¼Œä½†ä¸éœ€è¦è®¿é—®ç±»æˆ–å®ä¾‹çš„å±æ€§ã€‚

2. **ä»£ç ç»„ç»‡å’Œå‘½åç©ºé—´ç®¡ç†**ï¼šé™æ€æ–¹æ³•å¯ä»¥ç”¨äºå°†ç›¸å…³åŠŸèƒ½ç»„ç»‡åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬å®šä¹‰ä¸ºç‹¬ç«‹çš„å‡½æ•°ã€‚**è¿™æœ‰åŠ©äºä»£ç çš„ç»„ç»‡å’Œç®¡ç†ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­**ã€‚

	> ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸æŸä¸ªç±»ç›¸å…³çš„è¾…åŠ©å‡½æ•°å®šä¹‰ä¸ºé™æ€æ–¹æ³•ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬æ•£è½åœ¨ä¸åŒçš„æ¨¡å—ä¸­ã€‚

3. **ä¸éœ€è¦å®ä¾‹åŒ–**ï¼šç”±äºé™æ€æ–¹æ³•ä¸ä¾èµ–äºç±»æˆ–å®ä¾‹çš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸åˆ›å»ºç±»å®ä¾‹çš„æƒ…å†µä¸‹ç›´æ¥è°ƒç”¨å®ƒä»¬ã€‚è¿™ä½¿å¾—é™æ€æ–¹æ³•åœ¨æŸäº›æƒ…å†µä¸‹æ¯”å®ä¾‹æ–¹æ³•æ›´é«˜æ•ˆï¼Œå› ä¸ºä¸éœ€è¦å®ä¾‹åŒ–å¯¹è±¡ã€‚

4. **ç»§æ‰¿å’Œå¤šæ€**ï¼šé™æ€æ–¹æ³•é€šå¸¸ä¸ç”¨äºå®ç°å¤šæ€é€»è¾‘ã€‚

```python
class Utils:
    @staticmethod
    def add(*args):
        return sum(args)

    @staticmethod
    def average(*args):
        return Utils.add(*args) / len(args)


if __name__ == '__main__':
    res1 = Utils.add(1, 2, 3, 4, 5)
    res2 = Utils.average(1, 2, 3, 4, 5)

    print(f"{res1 = }")
    print(f"{res2 = }")
```

```
res1 = 15
res2 = 3.0
```

ä½¿ç”¨ `@staticmethod` è£…é¥°å™¨çš„ä¸»è¦å¥½å¤„æ˜¯èƒ½å¤Ÿå°†ä¸ç±»ç›¸å…³çš„åŠŸèƒ½ç»„ç»‡åœ¨ä¸€èµ·ï¼Œè€Œä¸ä¾èµ–äºç±»æˆ–å®ä¾‹çš„çŠ¶æ€ã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°ã€æ˜“äºç»´æŠ¤ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸å®ä¾‹åŒ–å¯¹è±¡çš„æƒ…å†µä¸‹ç›´æ¥è°ƒç”¨ç›¸å…³æ–¹æ³•ã€‚

## 6.3 @property

åœ¨Pythonä¸­ï¼Œ`@property` æ˜¯ä¸€ä¸ªå†…ç½®çš„è£…é¥°å™¨ï¼Œç”¨äºå°†ç±»ä¸­çš„æ–¹æ³•è½¬æ¢ä¸ºå±æ€§ï¼ˆå±æ€§è®¿é—®å™¨ï¼‰ã€‚ä½¿ç”¨ `@property` è£…é¥°å™¨çš„ä¸»è¦ä½œç”¨æ˜¯æä¾›ä¸€ç§å®‰å…¨ã€å¯æ§çš„æ–¹å¼æ¥è®¿é—®å’Œä¿®æ”¹ç±»çš„ç§æœ‰å±æ€§ã€‚ä»¥ä¸‹æ˜¯ `@property` è£…é¥°å™¨çš„ä¸€äº›å…³é”®ä½œç”¨å’Œä¼˜ç‚¹ï¼š

### 6.3.1 æä¾›å±æ€§è®¿é—®æ§åˆ¶

é€šè¿‡ä½¿ç”¨ `@property`ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ–¹æ³•è½¬æ¢ä¸ºå±æ€§ï¼Œä»è€Œåœ¨è®¿é—®å’Œä¿®æ”¹å±æ€§æ—¶æ·»åŠ è‡ªå®šä¹‰çš„é€»è¾‘ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥æ§åˆ¶å±æ€§çš„è¯»å–å’Œè®¾ç½®è¿‡ç¨‹ï¼Œç¡®ä¿å±æ€§å€¼çš„åˆæ³•æ€§å’Œä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼š

```python
class Person:
    def __init__(self, age):
        self._age = age

    @property
    def age(self):
        return self._age

    @age.setter
    def age(self, value):
        if value < 0:
            raise ValueError("Age cannot be negative")
        self._age = value


if __name__ == "__main__":
    person = Person(age=-1)
    print(f"[åˆ›å»ºPersonå¯¹è±¡] {person.age = }")

    person.age = 29
    print(f"[æ­£ç¡®ä¿®æ”¹ageå±æ€§] {person.age = }")

    try:
        person.age = -1
    except ValueError as e:
        print(f"ERROR âŒ {e}")
    finally:
        print(f"[é”™è¯¯ä¿®æ”¹ageå±æ€§] {person.age = }")
```

```
[åˆ›å»ºPersonå¯¹è±¡] person.age = -1
[æ­£ç¡®ä¿®æ”¹ageå±æ€§] person.age = 29
ERROR âŒ Age cannot be negative
[é”™è¯¯ä¿®æ”¹ageå±æ€§] person.age = 29
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`age` å±æ€§é€šè¿‡ `@property` è£…é¥°å™¨å®ç°ã€‚è®¿é—® `age` å±æ€§æ—¶ï¼Œä¼šè°ƒç”¨ `age` æ–¹æ³•ï¼›è®¾ç½® `age` å±æ€§æ—¶ï¼Œä¼šè°ƒç”¨ `age.setter` æ–¹æ³•ï¼Œå¹¶åœ¨è®¾ç½®å€¼ä¹‹å‰è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ã€‚

```mermaid
graph LR

å¼€å§‹ --> |åˆ›å»ºç±»| Person
Person --> |å±æ€§| self._age
Person --> |æ–¹æ³•| age
age --> ä½¿ç”¨propertyè£…é¥°å™¨å°†æ–¹æ³•è½¬æ¢ä¸ºå±æ€§
age --> ä½¿ç”¨setterè£…é¥°å™¨è®¾ç½®self._ageå±æ€§ä»è€Œå®ç°ageå±æ€§çš„ä¿®æ”¹
```

### 6.3.2 ä¿æŒä»£ç çš„ç®€æ´æ€§å’Œä¸€è‡´æ€§

ä½¿ç”¨ `@property` å¯ä»¥ä½¿ä»£ç æ›´åŠ ç®€æ´å’Œä¸€è‡´ã€‚æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼åœ°è°ƒç”¨æ–¹æ³•æ¥è·å–æˆ–è®¾ç½®å±æ€§å€¼ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨å±æ€§è®¿é—®è¯­æ³•ã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ ç›´è§‚å’Œæ˜“äºç†è§£ã€‚ä¾‹å¦‚ï¼š

```python
person = Person(25)
print(person.age)  # ç›´æ¥è®¿é—®å±æ€§ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ–¹æ³•
person.age = 30    # ç›´æ¥è®¾ç½®å±æ€§ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ–¹æ³•
```

### 6.3.3 æä¾›å±æ€§çš„åªè¯»æˆ–åªå†™èƒ½åŠ›

é€šè¿‡å®šä¹‰åªåŒ…å« `@property` çš„å±æ€§è®¿é—®å™¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºåªè¯»å±æ€§ã€‚è¿™æ„å‘³ç€å±æ€§åªèƒ½è¢«è¯»å–ï¼Œä¸èƒ½è¢«è®¾ç½®ã€‚ä¾‹å¦‚ï¼š

```python
class Circle:
    def __init__(self, radius):
        self._radius = radius

    @property
    def radius(self):  # åŠå¾„
        return self._radius

    @property
    def diameter(self):  # ç›´å¾„
        return 2 * self._radius
    

if __name__ == '__main__':
    circle = Circle(radius=2)

    print(f"åŠå¾„: {circle.radius}")
    print(f"ç›´å¾„: {circle.diameter}")
    
    try:
        circle.radius = 4
    except Exception as e:
        print(f"ERROR âŒ {e}")
```

```
åŠå¾„: 2
ç›´å¾„: 4
ERROR âŒ can't set attribute 'radius'
```

### 6.3.4 æ”¯æŒå±æ€§çš„è®¡ç®—å’Œç¼“å­˜

`@property` è£…é¥°å™¨å¯ä»¥ç”¨äºè®¡ç®—å±æ€§çš„å€¼ï¼Œæˆ–è€…å®ç°å±æ€§å€¼çš„ç¼“å­˜é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªè®¡ç®—å±æ€§æ¥è®¡ç®—æŸä¸ªå€¼ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½é‡æ–°è®¡ç®—ï¼Œä»è€Œæé«˜æ€§èƒ½ï¼š

```python
class Rectangle:
    def __init__(self, width, height):
        self._width = width
        self._height = height

    @property
    def area(self):
        return self._width * self._height
    

if __name__ == '__main__':
    rectangle = Rectangle(width=1920, height=1080)
    print(f"The area is {rectangle.area}")
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`area` æ˜¯ä¸€ä¸ªè®¡ç®—å±æ€§ï¼Œæ¯æ¬¡è®¿é—®æ—¶éƒ½ä¼šè®¡ç®—çŸ©å½¢çš„é¢ç§¯ã€‚

### 6.3.5 @propertyå’Œdeleterã€getterã€setterç»“åˆä½¿ç”¨

åœ¨Pythonä¸­ï¼Œ`@property` è£…é¥°å™¨ç”¨äºåˆ›å»ºå±æ€§è®¿é—®å™¨ï¼Œè€Œ `@<property>.getter`ã€`@<property>.setter` å’Œ `@<property>.deleter` è£…é¥°å™¨ç”¨äºå®šä¹‰å±æ€§çš„è·å–ã€è®¾ç½®å’Œåˆ é™¤é€»è¾‘ã€‚è¿™äº›è£…é¥°å™¨ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥æä¾›å¯¹ç±»å±æ€§çš„ç²¾ç»†æ§åˆ¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•å°†å®ƒä»¬ç»“åˆä½¿ç”¨ï¼š

```python
class Person:
    def __init__(self, name: str):
        self._name = name

    @property
    def name(self):
        """è·å–åå­—çš„å±æ€§è®¿é—®å™¨"""
        return self._name

    @name.setter
    def name(self, value):
        """è®¾ç½®åå­—çš„å±æ€§è®¾ç½®å™¨"""
        if not isinstance(value, str):
            raise ValueError(f"Name must be a string not {type(value).__name__}")
        self._name = value

    @name.deleter
    def name(self):
        """åˆ é™¤åå­—çš„å±æ€§åˆ é™¤å™¨"""
        print(f"Deleting {self._name}...")
        del self._name
        print(f"Delete done!")
    

if __name__ == '__main__':
    person = Person('Le0v1n')
    print(f"[åˆå§‹åŒ–] {person.name = }")

    person.name = 'Tom'
    print(f"[ä¿®æ”¹name] {person.name = }")

    del person.name
    try:
        print(f"[åˆ é™¤name] {person.name = }")
    except Exception as e:
        print(f"ERROR âŒ {e}")
```

```
[åˆå§‹åŒ–] person.name = 'Le0v1n'
[ä¿®æ”¹name] person.name = 'Tom'
Deleting Tom...
Delete done!
ERROR âŒ 'Person' object has no attribute '_name'
```

**ğŸ’¡æ³¨æ„äº‹é¡¹ï¼š**

- **`@property`**ï¼šç”¨äºå®šä¹‰å±æ€§çš„è·å–æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œ`@property` è£…é¥°çš„ `name` æ–¹æ³•å…è®¸æˆ‘ä»¬é€šè¿‡ `person.name` æ¥è·å– `self._name` çš„å€¼ã€‚
- **`@<property>.getter`**ï¼šè¿™æ˜¯ `@property` çš„åˆ«åï¼Œé€šå¸¸ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ã€‚ç›´æ¥ä½¿ç”¨ `@property` å°±å¯ä»¥å®šä¹‰è·å–æ–¹æ³•ã€‚
- **`@<property>.setter`**ï¼šç”¨äºå®šä¹‰å±æ€§çš„è®¾ç½®æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œ`@name.setter` è£…é¥°çš„ `name` æ–¹æ³•å…è®¸æˆ‘ä»¬é€šè¿‡ `person.name = "Le0v1n"` æ¥è®¾ç½® `self._name` çš„å€¼ï¼Œå¹¶åœ¨è®¾ç½®ä¹‹å‰è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ã€‚
- **`@<property>.deleter`**ï¼šç”¨äºå®šä¹‰å±æ€§çš„åˆ é™¤æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œ`@age.deleter` è£…é¥°çš„ `age` æ–¹æ³•å…è®¸æˆ‘ä»¬é€šè¿‡ `del person.age` æ¥åˆ é™¤ `self._age` å±æ€§ï¼Œå¹¶åœ¨åˆ é™¤ä¹‹å‰æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»åœ°æ§åˆ¶å±æ€§çš„è®¿é—®ã€è®¾ç½®å’Œåˆ é™¤é€»è¾‘ï¼Œç¡®ä¿å±æ€§å€¼çš„åˆæ³•æ€§å’Œä¸€è‡´æ€§.

---

ä½¿ç”¨ `@property` è£…é¥°å™¨çš„ä¸»è¦å¥½å¤„æ˜¯æä¾›äº†ä¸€ç§çµæ´»ã€å®‰å…¨çš„æ–¹å¼æ¥è®¿é—®å’Œä¿®æ”¹ç±»çš„å±æ€§ã€‚å®ƒä½¿ä»£ç æ›´åŠ ç®€æ´ã€ä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥å®ç°å±æ€§è®¿é—®æ§åˆ¶ã€åªè¯»/åªå†™å±æ€§ã€è®¡ç®—å±æ€§ç­‰åŠŸèƒ½ï¼Œä»è€Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§.

### 6.3.6 å¯ä»¥ç”¨äºä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„è£…é¥°å™¨

è¦å®ç°ä¸€ä¸ªæ—¢å¯ä»¥ä½œä¸ºè£…é¥°å™¨ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸Šä¸‹æ–‡ç®¡ç†å™¨ä½¿ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªç±»ï¼Œè¯¥ç±»åŒæ—¶å®ç°äº†è£…é¥°å™¨å’Œä¸Šä¸‹æ–‡ç®¡ç†å™¨æ‰€éœ€çš„æ¥å£ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```python
from functools import wraps


class ResourceManager:
    def __init__(self, resource):
        self.resource = resource
        print("[è£…é¥°å™¨] åˆå§‹åŒ–å®Œæˆ")

    def __call__(self, func):
        print("[è£…é¥°å™¨] [__call__] [å¼€å§‹]")
        
        @wraps(func)
        def wrapper(*args, **kwargs):
            # å°† self ä½œä¸ºä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨æ¥ä½¿ç”¨
            # ğŸš¨è¿™è¦æ±‚è¿™ä¸ªç±»å¿…é¡»æœ‰__enter__å’Œ__exit__æ–¹æ³•
            with self:
                print("[è£…é¥°å™¨] [è¢«è£…é¥°çš„å‡½æ•°] [å¼€å§‹]")
                return func(*args, **kwargs)
        
        print("[è£…é¥°å™¨] [__call__] [ç»“æŸ]")
        return wrapper

    def __enter__(self):
        """ä¸Šä¸‹æ–‡ç®¡ç†å™¨åè®®ï¼šè¿›å…¥"""
        print(f"[è£…é¥°å™¨] [ä¸Šä¸‹æ–‡ç®¡ç†å™¨] [è¿›å…¥] {self.resource}")

        # è¿™é‡Œå¯ä»¥æ·»åŠ è·å–èµ„æºçš„ä»£ç 
        self.temp_resource = "Temp Resource"
        self.results = "Results"

        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        """ä¸Šä¸‹æ–‡ç®¡ç†å™¨åè®®ï¼šé€€å‡º

        Args:
            exc_type (type): å¼‚å¸¸ç±»å‹ï¼Œå¦‚æœåœ¨ä¸Šä¸‹æ–‡å—ä¸­æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œåˆ™ä¸º None
            exc_val (Exception): å¼‚å¸¸å®ä¾‹ï¼Œå¦‚æœåœ¨ä¸Šä¸‹æ–‡å—ä¸­æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œåˆ™ä¸º None
            exc_tb (traceback): å¼‚å¸¸çš„è¿½è¸ªä¿¡æ¯ï¼Œå¦‚æœåœ¨ä¸Šä¸‹æ–‡å—ä¸­æ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œåˆ™ä¸º None

        Returns:
            bool: å¦‚æœè¿”å› Trueï¼Œåˆ™è¡¨ç¤ºå¼‚å¸¸å·²è¢«å¤„ç†ï¼Œä¸ä¼šå‘å¤–ä¼ æ’­ï¼›
                å¦‚æœè¿”å› False æˆ–å…¶ä»–å€¼ï¼Œåˆ™å¼‚å¸¸ä¼šç»§ç»­å‘å¤–ä¼ æ’­
        """
        print(f"[è£…é¥°å™¨] [ä¸Šä¸‹æ–‡ç®¡ç†å™¨] [é€€å‡º] {self.resource}")

        # è¿™é‡Œå¯ä»¥æ·»åŠ é‡Šæ”¾èµ„æºçš„ä»£ç 
        del self.temp_resource

        # å¦‚æœæœ‰å¼‚å¸¸å‘ç”Ÿï¼Œå¯ä»¥é€‰æ‹©å¦‚ä½•å¤„ç†
        if exc_type is not None:
            print(f"Exception occurred: {exc_type.__name__}, {exc_val}")
            # å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œå¼‚å¸¸å¤„ç†æˆ–è®°å½•
            # å¦‚æœè¦è®©å¼‚å¸¸ç»§ç»­å‘å¤–ä¼ æ’­ï¼Œè¿”å› False
            return False

        # å¦‚æœæ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œè¿”å› None æˆ–å…¶ä»–å€¼ï¼Œè¡¨ç¤ºæ­£å¸¸é€€å‡º
        return None


# ä½¿ç”¨è£…é¥°å™¨æ–¹å¼
@ResourceManager("database")
def use_resource():
    print("[ä½¿ç”¨è£…é¥°å™¨æ–¹å¼] Using the resource")


if __name__ == '__main__':
    use_resource()
    print()

    # ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–¹å¼
    with ResourceManager("file") as manager:
        print("[ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–¹å¼] Using the resource")
```

```
[è£…é¥°å™¨] åˆå§‹åŒ–å®Œæˆ
[è£…é¥°å™¨] [__call__] [å¼€å§‹]
[è£…é¥°å™¨] [__call__] [ç»“æŸ]
[è£…é¥°å™¨] [ä¸Šä¸‹æ–‡ç®¡ç†å™¨] [è¿›å…¥] database
[è£…é¥°å™¨] [è¢«è£…é¥°çš„å‡½æ•°] [å¼€å§‹]
[ä½¿ç”¨è£…é¥°å™¨æ–¹å¼] Using the resource
[è£…é¥°å™¨] [ä¸Šä¸‹æ–‡ç®¡ç†å™¨] [é€€å‡º] database

[è£…é¥°å™¨] åˆå§‹åŒ–å®Œæˆ
[è£…é¥°å™¨] [ä¸Šä¸‹æ–‡ç®¡ç†å™¨] [è¿›å…¥] file
[ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–¹å¼] Using the resource
[è£…é¥°å™¨] [ä¸Šä¸‹æ–‡ç®¡ç†å™¨] [é€€å‡º] file
```

è§£é‡Šå¦‚ä¸‹ï¼š

- **ç±»å®šä¹‰**ï¼š
  - `ResourceManager` ç±»æ¥å—ä¸€ä¸ª `resource` å‚æ•°ï¼Œç”¨äºæ ‡è¯†èµ„æºã€‚
  - `__call__` æ–¹æ³•ä½¿å¾—è¯¥ç±»çš„å®ä¾‹å¯ä»¥ä½œä¸ºè£…é¥°å™¨ä½¿ç”¨ã€‚å®ƒè¿”å›ä¸€ä¸ªåŒ…è£…å‡½æ•° `wrapper`ï¼Œè¯¥å‡½æ•°åœ¨è°ƒç”¨è¢«è£…é¥°çš„å‡½æ•°ä¹‹å‰å’Œä¹‹åä½¿ç”¨ `with` è¯­å¥æ¥ç®¡ç†èµ„æºã€‚
  - `__enter__` å’Œ `__exit__` æ–¹æ³•å®ç°äº†ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„æ¥å£ã€‚`__enter__` åœ¨è¿›å…¥ä¸Šä¸‹æ–‡æ—¶è¢«è°ƒç”¨ï¼Œ`__exit__` åœ¨é€€å‡ºä¸Šä¸‹æ–‡æ—¶è¢«è°ƒç”¨ã€‚

- **ä½¿ç”¨è£…é¥°å™¨æ–¹å¼**ï¼š
  - ä½¿ç”¨ `@ResourceManager("database")` è£…é¥° `use_resource` å‡½æ•°ã€‚å½“è°ƒç”¨ `use_resource()` æ—¶ï¼Œä¼šè‡ªåŠ¨ç®¡ç†èµ„æºçš„è·å–å’Œé‡Šæ”¾ã€‚

- **ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–¹å¼**ï¼š
  - ä½¿ç”¨ `with ResourceManager("file") as manager:` è¯­å¥æ¥åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œèµ„æºä¼šè¢«è·å–å’Œé‡Šæ”¾ã€‚

è¿™ç§æ–¹å¼ä½¿å¾— `ResourceManager` ç±»æ—¢å¯ä»¥ä½œä¸ºè£…é¥°å™¨ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸Šä¸‹æ–‡ç®¡ç†å™¨ä½¿ç”¨ï¼Œæä¾›äº†çµæ´»çš„èµ„æºç®¡ç†æ–¹å¼ã€‚


# å‚è€ƒ

1. [https://github.com/ultralytics/ultralytics](https://github.com/ultralytics/ultralytics)
2. [https://kimi.moonshot.cn/chat](https://kimi.moonshot.cn/chat)
3. [https://zhuanlan.zhihu.com/p/651228715](https://zhuanlan.zhihu.com/p/651228715)